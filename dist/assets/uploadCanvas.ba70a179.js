var y=Object.defineProperty,X=Object.defineProperties;var A=Object.getOwnPropertyDescriptors;var w=Object.getOwnPropertySymbols;var G=Object.prototype.hasOwnProperty,L=Object.prototype.propertyIsEnumerable;var C=(t,a,s)=>a in t?y(t,a,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[a]=s,f=(t,a)=>{for(var s in a||(a={}))G.call(a,s)&&C(t,s,a[s]);if(w)for(var s of w(a))L.call(a,s)&&C(t,s,a[s]);return t},g=(t,a)=>X(t,A(a));import{_}from"./index.0c3764fc.js";import{s as D,v as H,r as k,a5 as T,x as u,y as p,z as l,C as U,K as I,ar as Y,as as S,E as R,F as z}from"./@vue.c3bb5eb1.js";import"./vue-router.c336efea.js";import"./element-plus.12733ec3.js";import"./lodash.81388c16.js";import"./dayjs.d38e4417.js";import"./@vueuse.149d5305.js";import"./@element-plus.f66b6848.js";import"./@popperjs.7a88ba6a.js";import"./@ctrl.2e36ce53.js";import"./async-validator.5d25c98b.js";import"./memoize-one.4ee5c96d.js";import"./normalize-wheel-es.9a219a59.js";const B=D({emits:["transmit"],setup(t,{emit:a}){let s=document.documentElement.clientWidth,r=s,m=r*.7;console.log(s,r,m);const e=H({cW:r,cH:r,mW:m,mH:m,mL:(r-m)/2,mT:(r-m)/2,showMark:!1,iW:0,iH:0,iL:0,iT:0,IMAGE:null,CTX:null,curX:0,curY:0,newDataUrl:null});let n=k(null);const E=o=>{e.showMark=!0;let i=n.value.files[0];if(!i)return;let c=new FileReader;c.readAsDataURL(i),c.onload=d=>{e.IMAGE=new Image,e.IMAGE.src=d.target.result,e.IMAGE.onload=()=>{if(e.iW=e.IMAGE.width,e.iH=e.IMAGE.height,e.iW>e.cW){let h=e.iW/e.cW;e.iW=e.cW,e.iH=e.iH/h}else if(e.iH>e.cH){let h=e.iH/e.cH;e.iH=e.cH,e.iW=e.iW/h}e.iL=(e.cW-e.iW)/2,e.iT=(e.cW-e.iW)/2,v()}}},j=o=>{if(!e.IMAGE)return;let i=e.iW/e.iH,c=20,d=c/i;o?(e.iW+=c,e.iH+=d):(e.iW-=c,e.iH-=d),v()},M=o=>{!e.IMAGE||(e.curX=o.touches[0].clientX,e.curY=o.touches[0].clientY)},$=o=>{if(!e.IMAGE)return;let i=o.touches[0].clientX-e.curX,c=o.touches[0].clientY-e.curY;e.iL=e.iL+i,e.iT=e.iT+c,v(),e.curX=o.touches[0].clientX,e.curY=o.touches[0].clientY},b=()=>{if(!e.IMAGE)return;let o=e.CTX.getImageData(e.mL,e.mT,e.mW,e.mH),i=document.createElement("canvas");i.width=e.mW,i.height=e.mH,i.getContext("2d").putImageData(o,0,0,0,0,e.mW,e.mH),e.newDataUrl=i.toDataURL("image/png"),a("transmit",e.newDataUrl)};let W=k(null);const v=()=>{e.CTX=W.value.getContext("2d"),e.CTX.clearRect(0,0,e.cW,e.cH),e.CTX.drawImage(e.IMAGE,e.iL,e.iT,e.iW,e.iH)};return g(f({},T(e)),{fileOnchange:E,uploadfile:n,changeImage:j,touchstart:M,touchmove:$,keepSave:b,canvas:W})}}),O=t=>(Y("data-v-0c88f618"),t=t(),S(),t),F={class:"bord"},N=["width","height"],V={class:"btns"},K={class:"input"},q=O(()=>l("button",null,"\u9009\u62E9\u56FE\u7247",-1));function J(t,a,s,r,m,e){return u(),p("div",F,[l("div",{class:"detail",onTouchstart:a[0]||(a[0]=(...n)=>t.touchstart&&t.touchstart(...n)),onTouchmove:a[1]||(a[1]=(...n)=>t.touchmove&&t.touchmove(...n))},[l("canvas",{width:t.cW,height:t.cH,ref:"canvas"},null,8,N),t.showMark?(u(),p("div",{key:0,class:"mark",style:U({width:t.mW+"px",height:t.mH+"px",left:t.mL+"px",top:t.mT+"px"})},null,4)):I("",!0)],32),l("div",V,[l("div",K,[l("input",{type:"file",accept:"image/*",ref:"uploadfile",onChange:a[2]||(a[2]=(...n)=>t.fileOnchange&&t.fileOnchange(...n))},null,544)]),q,l("button",{onClick:a[3]||(a[3]=n=>t.changeImage(1))},"\u653E\u5927"),l("button",{onClick:a[4]||(a[4]=n=>t.changeImage(0))},"\u7F29\u5C0F"),l("button",{onClick:a[5]||(a[5]=(...n)=>t.keepSave&&t.keepSave(...n))},"\u4FDD\u5B58\u56FE\u7247")])])}var P=_(B,[["render",J],["__scopeId","data-v-0c88f618"]]);const Q={components:{ClipImage:P},setup(){const t=H({showImg:!1,dataUrl:""}),a=s=>{s&&(t.showImg=!0,t.dataUrl=s)};return g(f({},T(t)),{transmit:a})}},Z={class:"test"},x={key:1,class:"img"},ee=["src"];function te(t,a,s,r,m,e){const n=R("ClipImage");return u(),p("div",Z,[t.showImg?I("",!0):(u(),z(n,{key:0,onTransmit:r.transmit},null,8,["onTransmit"])),t.showImg?(u(),p("div",x,[l("img",{src:t.dataUrl,alt:""},null,8,ee)])):I("",!0)])}var fe=_(Q,[["render",te],["__scopeId","data-v-1e2f2b3d"]]);export{fe as default};
